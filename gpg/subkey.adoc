= Subkeys

Source: https://wiki.debian.org/Subkeys

== Make a backup

[source,shell script]
----
umask 077
tar -cf $HOME/gnupg-backup.tar -C $HOME .gnupg
----

== Create a new subkey for signing

[source,shell script]
----
gpg --list-keys $(whoami)
gpg --edit-key $MASTER_KEY_ID
# RSA (sign only), 4096 bit, 1m expiry
gpg> addkey
# RSA (encrypt only), 4096 bits, 1m expiry
gpg> addkey
gpg> save
----

== Remove master key from machine

[source,shell script]
----
# TODO cp -r? rsync? umask 077?
cp $HOME/.gnupg $USB_PATH

# ---- gpg 2.1 and later ----
gpg --with-keygrip --list-key $MASTER_KEY_ID
rm $HOME/.gnupg/private-keys-v1.d/$MASTER_KEYGRIP.key
# only in case of migration from older format
rm $HOME/.gnupg/secring.gpg
# verify master key lists sec# not sec
# TODO is this the same as gpg --list-secret-keys?
gpg -K
# change passphrase on subkeys, to protect master key in case subkey passphrase is compromised
gpg --edit-key $MASTER_KEY_ID passwd
----

== Revoke Subkey
[source,shell script]
----
export GNUPGHOME=$USB_PATH
gpg --edit-key $MASTER_KEY_ID
gpg> list
gpg> $UNWANTED_KEY_ID
gpg> revkey
----
